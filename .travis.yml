# default values
os: linux
dist: xenial

addons:
  apt:
    packages:
      - libboost-dev
      - libboost-regex-dev
      - libboost-system-dev
      - libboost-test-dev
      - libglew-dev
      - libicu-dev
      - libpng-dev
      - libsdl2-dev
      - libsdl2-image-dev
      - libsdl2-mixer-dev
      - libsdl2-ttf-dev
      - zlib1g-dev
  homebrew:
    packages:
      - ccache
      - glew
      - sdl2
      - sdl2_image
      - sdl2_mixer
      - sdl2_ttf
      - icu4c
    update: true

before_script:
  - >
    if [ "$TRAVIS_OS_NAME" = osx ]; then \
      # icu4c cannot be forced
      export ICU_ROOT="$(brew --prefix icu4c)" && \
      # add ccache and brew to the PATH variable
      export PATH="/usr/local/opt/ccache/libexec:/usr/local/opt/gettext/bin:$PATH"; \
    fi

branches:
  only:
    - travis-clang6

cache: ccache

jobs:
  include:
    - stage: compiler

      # Let's see if this works before changing the matrix
      name: "DEBUG: clang 6"
      os: linux
      compiler: clang
      cache: false
      addons:
        apt:
          sources:
            - sourceline: 'deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-6.0 main'
            - sourceline: 'deb-src http://apt.llvm.org/xenial/ llvm-toolchain-xenial-6.0 main'
              key_url: 'https://apt.llvm.org/llvm-snapshot.gpg.key'
          packages:
            - clang-6.0
            - libboost-dev
            - libboost-regex-dev
            - libboost-system-dev
            - libboost-test-dev
            - libglew-dev
            - libicu-dev
            - libpng-dev
            - libsdl2-dev
            - libsdl2-image-dev
            - libsdl2-mixer-dev
            - libsdl2-ttf-dev
            - zlib1g-dev
      env: BUILD_TYPE=Debug BUILD_TRANSLATIONS=OFF BUILD_WEBSITE_TOOLS=ON CC=clang-6.0 CXX=clang++-6.0
      services: xvfb
      before_script:
        - 'sudo ln -s /usr/bin/ccache /usr/lib/ccache/clang-6.0'
        - 'sudo ln -s /usr/bin/ccache /usr/lib/ccache/clang++-6.0'

language: cpp

script: ./.travis.sh build

stages:

  - compiler
