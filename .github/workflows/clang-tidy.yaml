name: Clang-Tidy

on:
  push:
    branches: [ clang-tidy-action ]
  pull_request:
    branches: [ master ]

jobs:
  check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        compiler: [clang]
    steps:
    steps:
    - name: Installing dependencies
      run: |
        sudo apt install git cmake g++ gcc gettext libboost-dev libboost-regex-dev libboost-system-dev libboost-test-dev libglew-dev libpng-dev libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev python zlib1g-dev -y
    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 1
    - name: Clang-Tidy
      run: |
        mkdir build && pushd build
        cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON ..
        python ../utils/run-clang-tidy.py -checks=-*,*braces*,cert*,clang-analyzer*,cppcoreguidelines-pro-type-static-cast-downcast,google-readability-casting,performance* > ../clang-tidy.log
        pushd ..
        utils/check_clang_tidy_results.py clang-tidy.log
