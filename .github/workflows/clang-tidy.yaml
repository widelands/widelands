name: Clang-Tidy

on:
  push:
    branches: [ clang-tidy-action ]
  pull_request:
    branches: [ master ]

jobs:
  check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        compiler: [clang]
    steps:
    - uses: actions/checkout@v2
    - name: clang-tidy
      run: |
        mkdir build && pushd build
        cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON ..
        python ../utils/run-clang-tidy.py -checks=-*,*braces*,cert*,clang-analyzer*,cppcoreguidelines-pro-type-static-cast-downcast,google-readability-casting,performance* > ../clang-tidy.log
        pushd ..
        utils/check_clang_tidy_results.py clang-tidy.log
